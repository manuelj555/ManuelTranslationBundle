<template>
    <div class="translation-item col-xs-12">
        <div class="panel panel-default" :class="{'translation-inactive': !translation.active}">
            <div class="panel-heading">

                <ItemHeader
                        :code="translation.code"
                        :domain="translation.domain"
                        :existentDomains="domains"
                        :autogenerated.once="translation.autogenerated"
                        :active="translation.active"
                        :editing="editing"
                        :onChangeData="updateData"
                ></ItemHeader>

            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-9 col-md-10">
                        <ItemValues
                                :values="translation.values"
                                :locales="locales"
                                :editing="editing"
                                :active="translation.active"
                                :onChangeData="updateData"
                        ></ItemValues>
                    </div>

                    <div class="col-sm-3 col-md-2">
                        <ItemButtons
                                :values="translation.values"
                                :locales="locales"
                                :editing="editing"
                                :active="translation.active"
                                :is-new="isNew"
                                :onSave="handleSave"
                                :onEdit="initEdition"
                                :onCancelEdit="cancelEdition"
                                :onActivate="handleActivate"
                                :onDeactivate="handleDeactivate"
                        ></ItemButtons>
                    </div>

                    <!--<div slot="extra-buttons">-->
                    <!--<button type="button" v-show="editing && isNew" class="btn btn-danger btn-xs" @click="remove()">{{ $t('label.cancel_reation') }}</button>-->

                    <!--<button type="button" v-show="showFilesVisible" class="btn btn-default btn-xs" @click="visibleFiles = true">Show Files</button>-->

                    <!--<button type="button" v-show="hideFilesVisible" class="btn btn-default btn-xs" @click="visibleFiles = false">Hide Files</button>-->
                    <!--</div>-->
                    <!--<div class="col-sm-12" v-if="hasFiles" v-show="editing || visibleFiles">-->
                    <!--<trans-item-files :files="item.files"></trans-item-files>-->
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    import Vue from 'vue'
    import ItemHeader from './Header.vue'
    import ItemValues from './Values.vue'
    import ItemButtons from './Buttons.vue'

    /*
     import TransItemFiles from './TransItemFiles.vue'
     import AlertIcon from '../directives/AlertIcon.vue'
     import Loading from 'vue-loading'
     import TransValidation from '../../js/TransValidation.js'
     */
    Vue.filter('defaultMessage', function (value) {
        return value || '[' + Vue.t('label.empty_value') + ']'
    })

    export default {
        props: {
            index: {required: true, type: [Number, String]},
            translation: {required: true, type: Object},
            locales: {type: [Array, Object], required: true},
            domains: {type: [Array, Object], required: true},
            changeData: {type: Function, required: true},
            activate: {type: Function, required: true},
            deactivate: {type: Function, required: true},
            save: {type: Function, required: true},
            remove: {type: Function, required: true},
        },

        data () {
            return {
                editing: false,
                visibleFiles: false,
                originalValues: {},
                originalCode: '',
//            validator: new TransValidation(this.item),
            }
        },

        computed: {
            isNew () {
                return null == this.translation.id
            },
        },

        created () {
            console.log('Creado Componente TransItem', this.index)
            if (this.isNew) {
                this.initEdition()
            }
        },

        destroyed () {
            console.log('Eliminado Componente TransItem', this.index)
        },

        methods: {
            initEdition () {
                this.editing = true
                this.originalValues = Object.assign({}, this.translation.values)
                this.originalCode = this.translation.code
            },
            cancelEdition () {
                if (this.isNew) {
                    // Si es una nueva traduccion, la borramos
                    this.remove(this.index)

                    return
                }

                this.editing = false

                this.changeData(this.index, {
                    code: this.originalCode,
                    values: this.originalValues,
                })
            },
            handleActivate() {
                return this.activate(this.index)
            },
            handleDeactivate() {
                return this.deactivate(this.index)
            },
            handleSave() {
                let isNew = this.isNew
                let promise = this.save(this.index);

                promise.then(() => {
                    this.editing = false
                })

                return promise
            },
            updateData(data) {
                this.changeData(this.index, data)
            },
        },

        components: {ItemValues, ItemButtons, /*ItemFiles,*/ ItemHeader},
        //directives: {Loading, AlertIcon},

    }

</script>

<style>
    .glyphicon.label:empty {
        display: inline;
    }

    .translation-item .alert {
        padding: 5px;
    }

    .translation-item .panel {
        margin-bottom: 10px;
    }

    .translation-item .panel-warning .panel-heading .text-muted {
        color: #FFFFFF;
    }

    .translation-item .panel-heading {
        padding: 6px 15px;
    }

    .translation-item .panel-body {
        padding: 10px;
    }

    .translation-item .translation-item-value {
        margin-bottom: 5px;
    }

    .translation-inactive .panel-heading {
        opacity: 0.4
    }

    .translation-inactive .panel-body {
        opacity: 0.7
    }


</style>